import pandas as pd
import argparse


def analyze_percentiles(data_path, col_to_analyze):
    data = pd.read_csv(data_path, delimiter=',')
    if data.columns.size < col_to_analyze + 1:
        raise ValueError(
            f'Invalid file; expected at least {col_to_analyze + 1} columns')

    print(
        f'Using column "{data.columns[col_to_analyze]}" as time in microsends')
    time_microsec = data.iloc[:, col_to_analyze]

    print(f'p50: {time_microsec.quantile(q=0.5)} microsec')
    print(f'p95: {time_microsec.quantile(q=0.95)} microsec')
    print(f'p99: {time_microsec.quantile(q=0.99)} microsec')


if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('data_path', type=str, nargs=1,
                        help='path to the CSV data generated by the benchmarks')

    parser.add_argument('col_to_analyze', type=int, nargs='?', default=1,
                        help='The index of the column to analyze.')

    args = parser.parse_args()
    analyze_percentiles(args.data_path[0], args.col_to_analyze)
